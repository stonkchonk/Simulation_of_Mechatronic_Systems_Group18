\documentclass[10pt,a4paper]{article}
\usepackage[letterpaper,top=2cm,bottom=2cm,left=3cm,right=3cm,marginparwidth=1.75cm]{geometry}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{url}
\usepackage{float}
\geometry{margin=1.8cm}

\usepackage{listings}
\usepackage{xcolor}

\lstdefinestyle{matlabstyle}{
	language=Matlab,
	basicstyle=\ttfamily\small,
	numbers=left,
	numberstyle=\tiny,
	backgroundcolor=\color{gray!5},
	frame=single,
	keywordstyle=\color{blue},
	commentstyle=\color{green!50!black},
	stringstyle=\color{orange},
	breaklines=true
}

\usepackage{hyperref}
\hypersetup{
	colorlinks=true,
	linkcolor=blue,
	filecolor=magenta,      
	urlcolor=cyan,
	pdftitle={Overleaf Example},
	pdfpagemode=FullScreen,
}


\title{Simulation of Mechatronic Systems \\\large Exercise 2 protocol}
\IfFileExists{authors.tex}{
	\input{authors} % this pulls in authors.tex
}{
	\author{please create an authors.tex file}
}

\begin{document}
	\maketitle
	\section*{Exercise 1a): Building up the simulation model inside Matlab}
	First of all, our spring pendulum model can be described by two differential equations. The first one describes the second derivative of pendulum length subject to time as:
	
	\begin{equation}
		\label{eqL}
		\ddot{L}(t)=\frac{g*m*\cos(\varphi(t)) - C*L(t) + C*L_0 + m*L(t)*\dot{\varphi}(t)^2}{m}
	\end{equation}
	\noindent
	Hereby $g$ represents earth's gravitational acceleration with $g=9.81\frac{m}{s^2}$, $m$ the pendulum's mass, $C$ a multiplying constant, $L$ the pendulum spring length or appropriate derivatives and $\varphi$ the pendulum's displacement from the center or appropriate derivatives. \newline
	The next equation describes the second derivative of the pendulum's displacement from the center subject to time as:
	
	\begin{equation}
		\label{eqP}
		\ddot{\varphi}(t)=-\frac{g*\sin(\varphi(t)) + 2*\dot{L}(t)*\dot{\varphi}(t)}{L(t)}
	\end{equation}
	\noindent
	Now that these equations for our model have been defined, we can determine first order differential equations for ode solvers so that the model can be simulated inside Matlab. For this, we assign some initial values $y_i$ to $L$, $\dot{L}$, $\varphi$ and $\dot{\varphi}$ as follows:\newline
	\begin{equation}
		\label{eqB}
		\begin{aligned}
			L = y_1 \\
			\dot{L}=y_2 \\
			\varphi=y_3 \\
			\dot{\varphi}=y_4
		\end{aligned}
	\end{equation}
	\noindent
	Using statements \ref{eqL}, \ref{eqP} and \ref{eqB}, we can determine derivatives for all equations of statement \ref{eqB} as follows: 
	\begin{equation}
		\label{eqD}
		\begin{aligned}
			\dot{L}=y_2 \\
			\ddot{L}=\frac{g*m*\cos(y_3) - C*y_1 + C*L_0 + m*y_1*y_4^2}{m} \\
			\dot{\varphi}=y_4 \\
			\ddot{\varphi}=-\frac{g*\sin(y_3) + 2*y_2*y_4}{y_1}
		\end{aligned}
	\end{equation}
	\noindent
	Using the above stated statements \ref{eqD}, we can derive some Matlab code so that our mathematical model can be computed by an ode solver. The code is stated below.
	\newpage
	\noindent
	\textbf{Matlab Code Snippet:}
	\lstinputlisting[style=matlabstyle, linerange={1-23}]{../simulation1.m}
	\newpage
	
	\section*{Exercise 1b): Simulating the system with different initial values and solvers}
	This task can be grouped into two sub tasks. For one, we want to simulate our pendulum spring system with different initial values. It is also a requirement that multiple solvers have to be used. As such, we are going to use a single fixed ode solver for simulating our system with different initial values. Furthermore, we are going to simulate a our system with fixed initial values using multiple solvers in order to compare solver performance.\newline
	The evaluation of resulting output will be conducted in the next section for task 1c).
	\subsection*{Simulating with different initial values and movement of the mass}
	For this sub task we chose the ode45 solver for all simulation executions. The thing that does change are the constant values. They are similar for all executions, namely the pendulum's mass $m=0.1 kg$, the spring constant $C=3.0 N/m$, the natural spring length $L_0 = 0.5m$. Furthermore, the simulation time for all runs is 10 seconds.
	\newline
	There is a multitude of scenarios we could simulate, however for the sake of simplicity we limit ourselves to four scenarios, thus four simulation runs with four sets of different initial values.
	\newline\newline
	\textbf{Scenario 1:} The pendulum's mass starts of at the natural spring length, with zero lateral and horizontal velocity and zero displacement.\newline
	$L=L_0$, $\dot{L}=0$, $\varphi=0$, $\dot{\varphi}=0$
	\newline\newline
	\textbf{Scenario 2:} The pendulum's mass starts of at the natural spring length, with zero lateral and horizontal velocity and a displacement of 45°.\newline
	$L=L_0$, $\dot{L}=0$, $\varphi=\frac{\pi}{4}$, $\dot{\varphi}=0$
	\newline\newline
	\textbf{Scenario 3:} The pendulum's mass starts of at a compressed spring length, with zero lateral and horizontal velocity and a displacement of 45°.\newline
	$L=0.1$, $\dot{L}=0$, $\varphi=\frac{\pi}{4}$, $\dot{\varphi}=0$
	\newline\newline
	\textbf{Scenario 4:} The pendulum's mass starts of at natural spring length, with some lateral and horizontal velocity and a displacement of 45°.\newline
	$L=0.1$, $\dot{L}=1$, $\varphi=\frac{\pi}{4}$, $\dot{\varphi}=\frac{\pi}{4}$
	\newline\newline
	These values yield the following plots for mass movements and the total plot for system parameters subject to time:\newline
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.8\linewidth]{sim1mass.pdf}
		\caption{Mass movement for scenario 1.}
		\label{fig:sim1mass}
	\end{figure}
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.8\linewidth]{sim2mass.pdf}
		\caption{Mass movement for scenario 2.}
		\label{fig:sim2mass}
	\end{figure}
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.8\linewidth]{sim3mass.pdf}
		\caption{Mass movement for scenario 3.}
		\label{fig:sim3mass}
	\end{figure}
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.8\linewidth]{sim4mass.pdf}
		\caption{Mass movement for scenario 4.}
		\label{fig:sim4mass}
	\end{figure}
	\noindent
	The above Figures \ref{fig:sim1mass}, \ref{fig:sim2mass}, \ref{fig:sim3mass} and \ref{fig:sim4mass} display the movement path of the pendulum's mass over a time frame of ten seconds for our previously defined scenarios or otherwise previously defined different initial values. Next up, we take a look at the system parameters and how they change over time.
	\newline
	\begin{figure}[H]
		\centering
		\includegraphics[width=1.0\linewidth]{system_values.pdf}
		\caption{System parameters and how they change over time.}
		\label{fig:sysparams}
	\end{figure}
	\noindent
	Figure \ref{fig:sysparams} shows graphs for our system's parameters spring length, change of spring length, angular displacement and change of angular displacement for the previously defined four scenarios subject to a time frame of ten seconds.\newline
	\textbf{Matlab Code Snippet:}
	\lstinputlisting[style=matlabstyle, linerange={1-62, 82-106}]{../Excercise_2_Alessandro.m}
	
	\subsection*{Simulating with different ode solvers}
	Next, we want to test the performance of different ode solvers. Specifically, we want to compare three other solvers to the ode45 solver, which we used previously. According to the \href{https://de.mathworks.com/help/matlab/math/choose-an-ode-solver.html}{Matlab Documentation for choosing ode solvers}, ode45 is of medium accuracy. The to be compared solvers are ode23 (low accuracy), ode15s (low to medium accuracy, used for stiff systems) and ode89 (high accuracy). The test is to be conducted by comparing the value of $L(t)$ over a time frame of 25 seconds, always with similar initial conditions.\newline
	The following graphic below displays the results as three plots:
	\begin{figure}[H]
		\centering
		\includegraphics[width=1.0\linewidth]{solver_comparrison.pdf}
		\caption{Simulating L(t) over a time frame of 25 seconds using various solvers.}
		\label{fig:solver_comparrison}
	\end{figure}
	\noindent
	The evaluation of resulting output will be conducted in the next section for task 1c).
	\newline
	\noindent
	\textbf{Matlab Code Snippet:}
	\lstinputlisting[style=matlabstyle, linerange={35-46, 56-81}]{../simulation1.m}
	
	\section*{Exercise 1c): Comparing results different initial values and solvers}
	Now that we have generated some plots, we can compare the results for different initial values and different solvers.
	\subsection*{Different initial values}
	As is visible in Figures \ref{fig:sim1mass}, \ref{fig:sim2mass}, \ref{fig:sim3mass} and \ref{fig:sim4mass}, different Scenarios result in drastically varying movement patterns of the pendulum's mass. This can also be observed in the plots of Figure \ref{fig:sysparams}. A special case is Scenario 1, as there is no angular movement which explains the flat line for angular displacement and angular velocity.
	\subsection*{Different initial solvers}
	What becomes apparent is the fact, that the results of ode23 and ode15s start to visibly diverge from the result of ode45 after a few seconds. The offset increases, the longer our simulation takes to compute.\newline
	The result of ode89 is visibly almost identical to the result of ode45 throughout the entire simulation run. 
	\section*{Exercise 1d): Documenting our work and problems using the solvers}
	We consider this task to be fulfilled as we documented our work right here with this protocol.
		
\end{document}
