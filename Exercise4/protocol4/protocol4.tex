\documentclass[10pt,a4paper]{article}
\usepackage[letterpaper,top=2cm,bottom=2cm,left=3cm,right=3cm,marginparwidth=1.75cm]{geometry}
\usepackage{amsmath}
\usepackage{graphicx}
\usepackage{url}
\usepackage{float}
\geometry{margin=1.8cm}

\usepackage{listings}
\usepackage{xcolor}

\lstdefinestyle{matlabstyle}{
	language=Matlab,
	basicstyle=\ttfamily\small,
	numbers=left,
	numberstyle=\tiny,
	backgroundcolor=\color{gray!5},
	frame=single,
	keywordstyle=\color{blue},
	commentstyle=\color{green!50!black},
	stringstyle=\color{orange},
	breaklines=true
}

\usepackage{hyperref}
\hypersetup{
	colorlinks=true,
	linkcolor=blue,
	filecolor=magenta,      
	urlcolor=cyan,
	pdftitle={Overleaf Example},
	pdfpagemode=FullScreen,
}


\title{Simulation of Mechatronic Systems \\\large Exercise 4 protocol - Model of a speed control}
\IfFileExists{authors.tex}{
	\input{authors} % this pulls in authors.tex
}{
	\author{please create an authors.tex file}
}

\begin{document}
	\maketitle
	\section*{Exercise 4a): Build up a simulation model of the dc-motor (open-loop) and testing it}
	In the first sub task of this exercise, we want build an open loop model of a dc-motor and test it.
	The motor model is defined by the following differential equations \ref{eqUt}, \ref{eqJ}, \ref{eqIt} and \ref{eqWt} below:
	\begin{equation}\label{eqUt}
		u(t)=R\cdot i(t) +L\cdot \frac{d}{dt}(i(t))+c_m\cdot \dot{\alpha}(t)
	\end{equation}
	\begin{equation}\label{eqJ}
		J\cdot \ddot{\alpha}(t) = c_m \cdot i(t)-D\cdot \dot{\alpha}(t)
	\end{equation}
	\begin{equation}\label{eqIt}
		\frac{d}{dt}(i(t)) = \frac{1}{L}(u(t)-R\cdot i(t) -c_m\cdot \omega (t))
	\end{equation}
	\begin{equation}\label{eqWt}
		\frac{d}{dt}(\omega (t)) = \frac{1}{J}(c_m \cdot i(t)-D\cdot \omega (t))
	\end{equation}
	\noindent
	The voltage $u(t)$ is the input of the open loop system and $\omega (t)$, the angular motor speed, the output of the system. Furthermore, the dc-motor is defined by some fixed physical properties:
	\begin{itemize}
		\item $L=0.23 \cdot 10^{-3}H$
		\item $c_m = 23.4 \cdot 10^{-3} \frac{Nm}{A}$
		\item $R = 2.4 \Omega$
		\item $J = 0.23 \cdot 10^{-6} Nm^{2}$
		\item $D = 0.4191 \cdot 10^{-5} \frac{Ns}{m}$
	\end{itemize}
	\noindent
	Using this information, we can write a Matlab script and build a Simulink model to generate a step response for our open loop dc-motor model. Both of these components are shown below:\newline\newline
	\noindent
	\textbf{Matlab Code Snippet:}
	\lstinputlisting[style=matlabstyle]{../exercise4 sudeesh/exercise4rea.m}
	\noindent
	\textbf{Simulink Model:}
	\begin{figure}[H]
		\centering
		\includegraphics[width=1.0\linewidth]{openLoopSimulink.png}
		\caption{Open loop model of a dc-motor.}
		\label{fig:openLoopModelSimulink}
	\end{figure}
	\noindent
	\newpage
	Running this model and code yields the following step response for $i(t)$ and $\omega(t)$ subject to time:
	\begin{figure}[H]
		\centering
		\includegraphics[width=1.0\linewidth]{step_response_4a.pdf}
		\caption{Step response of an open loop model of a dc-motor.}
		\label{fig:stepResponse4a}
	\end{figure}
	\noindent
	As show above in figure \ref{fig:stepResponse4a} both $i(t)$ and $\omega(t)$ converge towards a steady value after about 0.005 seconds. Now that we have a working open loop model of a dc-motor, we can continue on to optimize it with a simple speed controller.
	\newpage
	
	\section*{Exercise 4b): Changing parameters of the controller to get a good control behavior}
	Within the exercise description, there is already an illustration of a dc-motor that uses the output value $\omega$ to influence a controller $K_P$ which then again influences the input voltage $u$. This is displayed below in figure \ref{fig:dcMotorSpeedControl}:
	\begin{figure}[H]
		\centering
		\includegraphics[width=1.0\linewidth]{openloop.png}
		\caption{Model of a dc-motor hooked up to a speed controller $K_P$.}
		\label{fig:dcMotorSpeedControl}
	\end{figure}
	\noindent
	Now, we build this model within Simulink which is shown below in figure \ref{fig:dcMotorSpeedControlSimulink}:
	\newline\newline
	\textbf{Simulink Model:}
	\begin{figure}[H]
		\centering
		\includegraphics[width=1.0\linewidth]{closedLoopDcMotor.png}
		\caption{Model of a dc-motor hooked up to a speed controller $K_P$ in Simulink.}
		\label{fig:dcMotorSpeedControlSimulink}
	\end{figure}
	\noindent
	Hereby our speed controller simply consists of a gain block which multiplies the output angular speed $\omega$ by a factor $K_P$ and adds that to the input voltage $u$. A good control behavior is accomplished when the motor converges towards a steady angular speed $\omega$ and current $i$ as fast as possible. Without controller the motor takes about 0.005 seconds, as determined in the previous sub task. \newline
	This Simulink model gets called upon in the Matlab script as stated below:\newline\newline
	\noindent
	\textbf{Matlab Code Snippet:}
	\lstinputlisting[style=matlabstyle]{../exercise4 sudeesh/exercise4reab.m}
	\noindent
	The value $K_P$ is chosen as $K_P=0.05$ with which the closed loop model gets called. This yields a much faster convergence of $i(t)$ and $\omega(t)$ compared to the open loop system without controller. The resulting plot can be seen below in figure \ref{fig:stepResponse4b}. Within just 0.001 seconds the system reaches a state of convergence, so that $i(t)$ and $\omega(t)$ remain constant. This equates to a time span which is five times shorter compared to the unregulated system.
	\begin{figure}[H]
		\centering
		\includegraphics[width=1.0\linewidth]{step_response_4b.pdf}
		\caption{Step response of a closed loop model of a dc-motor.}
		\label{fig:stepResponse4b}
	\end{figure}
	\noindent
	\newpage
	
	\section*{Exercise 4c): Trying different solvers and comparing the results.}
	For this sub task we are going to simulate our closed loop system with controller value $K_P=0.05$ using different solvers of different accuracy for non-stiff and stiff systems. Specifically we chose ode45 and ode23 for non-stiff systems and ode15s and ode23s for stiff systems. With these requirements we can formulate a Matlab script to determine results. Furthermore, we are using state equations of the closed loop system to simulate it, so that ode solvers can handle this problem. This gets apparent from the Matlab code as stated below:\newline\newline
	\noindent
	\textbf{Matlab Code Snippet:}
	\lstinputlisting[style=matlabstyle]{../exercise4 sudeesh/exer4creal.m}
	\noindent
	The simulations only run for a very short time frame of 3 milliseconds each. This can be done, because the current values converge after just about a single millisecond. For better comparison, we overlap all of the resulting graphs in the same plot. This is shown in figures \ref{fig:stepResponse4c1} and \ref{fig:stepResponse4c2} below. For this comparison we are using two images of the same plot in order to showcase the similarity of the results.
	\begin{figure}[H]
		\centering
		\includegraphics[width=1.0\linewidth]{solverComparison.pdf}
		\caption{Step response $i(t)$ of a closed loop model of a dc-motor for different solvers.}
		\label{fig:stepResponse4c1}
	\end{figure}
	\begin{figure}[H]
		\centering
		\includegraphics[width=1.0\linewidth]{zoom.pdf}
		\caption{Step response $i(t)$ of a closed loop model of a dc-motor for different solvers zoomed in.}
		\label{fig:stepResponse4c2}
	\end{figure}
	\noindent
	Apparently, the results seem to be very similar for all four solvers, no matter if they are designated for stiff or non-stiff systems. Only when zooming in very close, in this case close to the maximum, minor differences become apparent. These differences can be attributed to the different underlying algorithmic methods used by the solvers. Apart from that, they deliver basically equal results.
	

		
\end{document}
